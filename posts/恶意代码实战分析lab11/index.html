<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>恶意代码分析实战Lab11 - xia0le&#39;s Blog</title><meta name="author" content="xia0le">
<meta name="description" content="恶意代码分析实战Lab11
"><meta name="keywords" content='病毒分析, Binary'>
  <meta itemprop="name" content="恶意代码分析实战Lab11">
  <meta itemprop="description" content="恶意代码分析实战Lab11">
  <meta itemprop="datePublished" content="2022-04-01T21:47:44+08:00">
  <meta itemprop="dateModified" content="2022-04-01T21:47:44+08:00">
  <meta itemprop="wordCount" content="216">
  <meta itemprop="keywords" content="病毒分析,Binary"><meta property="og:url" content="http://localhost:1313/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/">
  <meta property="og:site_name" content="xia0le&#39;s Blog">
  <meta property="og:title" content="恶意代码分析实战Lab11">
  <meta property="og:description" content="恶意代码分析实战Lab11">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-04-01T21:47:44+08:00">
    <meta property="article:modified_time" content="2022-04-01T21:47:44+08:00">
    <meta property="article:tag" content="病毒分析">
    <meta property="article:tag" content="Binary">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="恶意代码分析实战Lab11">
  <meta name="twitter:description" content="恶意代码分析实战Lab11">
<meta name="application-name" content="FixIt">
<meta name="apple-mobile-web-app-title" content="FixIt"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" type="text/html" href="http://localhost:1313/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/" title="恶意代码分析实战Lab11 - xia0le&#39;s Blog" /><link rel="prev" type="text/html" href="http://localhost:1313/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab3/" title="恶意代码分析实战Lab3" /><link rel="next" type="text/html" href="http://localhost:1313/posts/2022%E5%BC%BA%E7%BD%91%E6%9D%AF-devnull/" title="2022 强网杯-devnull" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "恶意代码分析实战Lab11",
    "inLanguage": "en-us",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "http:\/\/localhost:1313\/posts\/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11\/"
    },"genre": "posts","keywords": "病毒分析, Binary","wordcount":  216 ,
    "url": "http:\/\/localhost:1313\/posts\/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11\/","datePublished": "2022-04-01T21:47:44+08:00","dateModified": "2022-04-01T21:47:44+08:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "xia0le"
      },"description": ""
  }
  </script><script src="/js/head/color-scheme.min.js"></script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="xia0le&#39;s Blog"><span class="header-title-text">xia0le&#39;s Blog</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a class="menu-link" href="/posts/"><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> Archives</a></li><li class="menu-item">
              <a class="menu-link" href="/categories/"><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item">
              <a class="menu-link" href="/tags/"><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item">
              <a class="menu-link" href="/about/"><i class="fa-solid fa-user fa-fw fa-sm" aria-hidden="true"></i> About</a></li><li class="menu-item delimiter"></li><li class="menu-item theme-switch" title="Switch Theme">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="xia0le&#39;s Blog"><span class="header-title-text">xia0le&#39;s Blog</span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="menu-item"><a class="menu-link" href="/posts/"><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> Archives</a></li><li class="menu-item"><a class="menu-link" href="/categories/"><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item"><a class="menu-link" href="/tags/"><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item"><a class="menu-link" href="/about/"><i class="fa-solid fa-user fa-fw fa-sm" aria-hidden="true"></i> About</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><main class="container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="Collections"></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span title="Repost" class="icon-repost"><i class="fa-solid fa-share fa-fw" aria-hidden="true"></i></span><span>恶意代码分析实战Lab11</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><span class="author"><i class="fa-solid fa-user-circle" aria-hidden="true"></i>
      xia0le</span></span><span class="post-included-in">&nbsp;included in <a href="/categories/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98/" class="post-category" title="Category - 恶意代码分析实战"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> 恶意代码分析实战</a></span></div><div class="post-meta-line"><span title="published on 2022-04-01 21:47:44"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden="true"></i><time datetime="2022-04-01">2022-04-01</time></span>&nbsp;<span title="216 words"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>About 300 words</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>2 minutes</span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>Contents</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#1这个恶意代码向磁盘释放了什么">1．这个恶意代码向磁盘释放了什么?</a></li>
    <li><a href="#2这个恶意代码如何进行驻留">2．这个恶意代码如何进行驻留?</a></li>
    <li><a href="#3这个恶意代码如何窃取用户登录凭证">3．这个恶意代码如何窃取用户登录凭证?</a></li>
    <li><a href="#4这个恶意代码对窃取的证书做了什么处理">4．这个恶意代码对窃取的证书做了什么处理?</a></li>
    <li><a href="#5如何在你的测试环境让这个恶意代码获得用户登录凭证">5．如何在你的测试环境让这个恶意代码获得用户登录凭证?</a></li>
  </ul>

  <ul>
    <li><a href="#1这个恶意dll导出了什么">1.这个恶意DLL导出了什么?</a></li>
    <li><a href="#2使用rundll32exe安装这个恶意代码后发生了什么">2.使用rundll32.exe安装这个恶意代码后，发生了什么?</a></li>
    <li><a href="#3为了使这个恶意代码正确安装lab11-o2ini-必须放置在何处">3.为了使这个恶意代码正确安装，Lab11-O2.ini 必须放置在何处?</a></li>
    <li><a href="#4这个安装的恶意代码如何驻留">4.这个安装的恶意代码如何驻留?</a></li>
    <li><a href="#5这个恶意代码采用的用户态-rootkit技术是什么">5.这个恶意代码采用的用户态 Rootkit技术是什么?</a></li>
    <li><a href="#6挂钩代码做了什么">6.挂钩代码做了什么?</a></li>
    <li><a href="#7哪个或者哪些进程执行这个恶意攻击为什么">7.哪个或者哪些进程执行这个恶意攻击，为什么?</a></li>
    <li><a href="#8ini文件的意义是什么">8.ini文件的意义是什么?</a></li>
    <li><a href="#9你怎样用wireshark动态抓获这个恶意代码的行为">9.你怎样用Wireshark动态抓获这个恶意代码的行为?</a></li>
  </ul>

  <ul>
    <li><a href="#1使用基础的静态分析过程你可以发现什么有趣的线索">1.使用基础的静态分析过程，你可以发现什么有趣的线索?</a></li>
    <li><a href="#2当运行这个恶意代码时发生了什么">2.当运行这个恶意代码时，发生了什么?</a></li>
    <li><a href="#3lab11-03exe-如何安装lab11-o3dll使其长期驻留">3.Lab11-03.exe 如何安装Lab11-O3.dll使其长期驻留?</a></li>
    <li><a href="#4这个恶意代码感染-windows系统的哪个文件">4.这个恶意代码感染 Windows系统的哪个文件?</a></li>
    <li><a href="#5lab11-03dll做了什么">5.Lab11-03.dll做了什么?</a></li>
    <li><a href="#6这个恶意代码将收集的数据存放在何处">6.这个恶意代码将收集的数据存放在何处?</a></li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><p>恶意代码分析实战Lab11</p>
<h2 id="lab11-1" class="heading-element"><span>Lab11-1</span>
  <a href="#lab11-1" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>strings</p>
<p>可能存在窃取用户登录凭证                                                                                                                                                                                                                                                                                <br>
<img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410161754-rmq94ag.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410161754-rmq94ag.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410161754-rmq94ag.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410161754-rmq94ag.png?size=large 2x" data-title="image.png" style="--width: 1275px;--aspect-ratio: 1275 / 866;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>peid</p>
<p>资源操作</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410162010-ts9lzbm.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410162010-ts9lzbm.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410162010-ts9lzbm.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410162010-ts9lzbm.png?size=large 2x" data-title="image.png" style="--width: 629px;--aspect-ratio: 629 / 406;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>注册表操作</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410161928-lcewyyi.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410161928-lcewyyi.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410161928-lcewyyi.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410161928-lcewyyi.png?size=large 2x" data-title="image.png" style="--width: 619px;--aspect-ratio: 619 / 377;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>source hacker查看资源</p>
<p>有PE文件</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410162335-vbsmbmx.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410162335-vbsmbmx.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410162335-vbsmbmx.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410162335-vbsmbmx.png?size=large 2x" data-title="image.png" style="--width: 1016px;--aspect-ratio: 1016 / 709;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>导出二进制文件为exe</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410162501-lyhzxt5.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410162501-lyhzxt5.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410162501-lyhzxt5.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410162501-lyhzxt5.png?size=large 2x" data-title="image.png" style="--width: 801px;--aspect-ratio: 801 / 643;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>peid打开发现是dll文件</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410162603-k5tmuc0.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410162603-k5tmuc0.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410162603-k5tmuc0.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410162603-k5tmuc0.png?size=large 2x" data-title="image.png" style="--width: 424px;--aspect-ratio: 424 / 232;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>然后改名为dll文件</p>
<p>使用process monitor 分析</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410163030-c8nkf1t.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410163030-c8nkf1t.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410163030-c8nkf1t.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410163030-c8nkf1t.png?size=large 2x" data-title="image.png" style="--width: 547px;--aspect-ratio: 547 / 348;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410163929-v76wlom.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410163929-v76wlom.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410163929-v76wlom.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410163929-v76wlom.png?size=large 2x" data-title="image.png" style="--width: 1438px;--aspect-ratio: 1438 / 764;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>注册表查看</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410164104-7embm9h.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410164104-7embm9h.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410164104-7embm9h.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410164104-7embm9h.png?size=large 2x" data-title="image.png" style="--width: 1146px;--aspect-ratio: 1146 / 472;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h2 id="1这个恶意代码向磁盘释放了什么" class="heading-element"><span>1．这个恶意代码向磁盘释放了什么?</span>
  <a href="#1%e8%bf%99%e4%b8%aa%e6%81%b6%e6%84%8f%e4%bb%a3%e7%a0%81%e5%90%91%e7%a3%81%e7%9b%98%e9%87%8a%e6%94%be%e4%ba%86%e4%bb%80%e4%b9%88" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>msgina32.dll</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410164200-6yafncd.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410164200-6yafncd.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410164200-6yafncd.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410164200-6yafncd.png?size=large 2x" data-title="image.png" style="--width: 183px;--aspect-ratio: 183 / 95;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h2 id="2这个恶意代码如何进行驻留" class="heading-element"><span>2．这个恶意代码如何进行驻留?</span>
  <a href="#2%e8%bf%99%e4%b8%aa%e6%81%b6%e6%84%8f%e4%bb%a3%e7%a0%81%e5%a6%82%e4%bd%95%e8%bf%9b%e8%a1%8c%e9%a9%bb%e7%95%99" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>查看提取的和释放的dll文件md5是否一致</p>
<p>提取的</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410164707-4vh8da5.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410164707-4vh8da5.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410164707-4vh8da5.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410164707-4vh8da5.png?size=large 2x" data-title="image.png" style="--width: 515px;--aspect-ratio: 515 / 362;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>释放的</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410164731-1qlrznk.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410164731-1qlrznk.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410164731-1qlrznk.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410164731-1qlrznk.png?size=large 2x" data-title="image.png" style="--width: 513px;--aspect-ratio: 513 / 367;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>一致</p>
<p>程序被写入到GinaDll重启会自动加载</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410164104-7embm9h.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410164104-7embm9h.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410164104-7embm9h.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410164104-7embm9h.png?size=large 2x" data-title="image.png" style="--width: 1146px;--aspect-ratio: 1146 / 472;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h2 id="3这个恶意代码如何窃取用户登录凭证" class="heading-element"><span>3．这个恶意代码如何窃取用户登录凭证?</span>
  <a href="#3%e8%bf%99%e4%b8%aa%e6%81%b6%e6%84%8f%e4%bb%a3%e7%a0%81%e5%a6%82%e4%bd%95%e7%aa%83%e5%8f%96%e7%94%a8%e6%88%b7%e7%99%bb%e5%bd%95%e5%87%ad%e8%af%81" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>strings分析提取的dll文件</p>
<p>有很多Gina函数，有格式化字符串可能用来记录凭证</p>
<p>还有msutil32.sys文件</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410165147-ozwsosi.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410165147-ozwsosi.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410165147-ozwsosi.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410165147-ozwsosi.png?size=large 2x" data-title="image.png" style="--width: 1143px;--aspect-ratio: 1143 / 865;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>ida打开dll</p>
<p>判断程序是否在加载时调用</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410165416-2rt1sb0.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410165416-2rt1sb0.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410165416-2rt1sb0.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410165416-2rt1sb0.png?size=large 2x" data-title="image.png" style="--width: 726px;--aspect-ratio: 726 / 310;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>如果是</p>
<p>GetSystemDirectoryW 获取目录</p>
<p>lstrcatW 组合目录</p>
<p>LoadLibraryW 加载调用</p>
<p>这里的MSGina实现真实的功能</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410165512-fzf152w.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410165512-fzf152w.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410165512-fzf152w.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410165512-fzf152w.png?size=large 2x" data-title="image.png" style="--width: 362px;--aspect-ratio: 362 / 447;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>查看导出表</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410165807-e5vr02z.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410165807-e5vr02z.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410165807-e5vr02z.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410165807-e5vr02z.png?size=large 2x" data-title="image.png" style="--width: 1189px;--aspect-ratio: 1189 / 591;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>进入函数</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410165941-ns6xbeh.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410165941-ns6xbeh.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410165941-ns6xbeh.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410165941-ns6xbeh.png?size=large 2x" data-title="image.png" style="--width: 450px;--aspect-ratio: 450 / 222;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>WlxLoggedOnSAS</p>
<p>GetProcess获取真实的Gina</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410165958-3z8oc2g.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410165958-3z8oc2g.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410165958-3z8oc2g.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410165958-3z8oc2g.png?size=large 2x" data-title="image.png" style="--width: 871px;--aspect-ratio: 871 / 683;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>WlxLoggedOutSAS 系统注销时调用</p>
<p>进入函数</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410170303-v8nhv6j.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410170303-v8nhv6j.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410170303-v8nhv6j.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410170303-v8nhv6j.png?size=large 2x" data-title="image.png" style="--width: 628px;--aspect-ratio: 628 / 304;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>将时间，日期，打印等信息写入到msutil32.sys中</p>
<p>‍</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410170324-ohrqqxk.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410170324-ohrqqxk.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410170324-ohrqqxk.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410170324-ohrqqxk.png?size=large 2x" data-title="image.png" style="--width: 741px;--aspect-ratio: 741 / 573;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>使用Ginan拦截用户的登录凭证</p>
<h2 id="4这个恶意代码对窃取的证书做了什么处理" class="heading-element"><span>4．这个恶意代码对窃取的证书做了什么处理?</span>
  <a href="#4%e8%bf%99%e4%b8%aa%e6%81%b6%e6%84%8f%e4%bb%a3%e7%a0%81%e5%af%b9%e7%aa%83%e5%8f%96%e7%9a%84%e8%af%81%e4%b9%a6%e5%81%9a%e4%ba%86%e4%bb%80%e4%b9%88%e5%a4%84%e7%90%86" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>msutil32.sys 用户名，密码、时间，日期都记录在这个文件里</p>
<h2 id="5如何在你的测试环境让这个恶意代码获得用户登录凭证" class="heading-element"><span>5．如何在你的测试环境让这个恶意代码获得用户登录凭证?</span>
  <a href="#5%e5%a6%82%e4%bd%95%e5%9c%a8%e4%bd%a0%e7%9a%84%e6%b5%8b%e8%af%95%e7%8e%af%e5%a2%83%e8%ae%a9%e8%bf%99%e4%b8%aa%e6%81%b6%e6%84%8f%e4%bb%a3%e7%a0%81%e8%8e%b7%e5%be%97%e7%94%a8%e6%88%b7%e7%99%bb%e5%bd%95%e5%87%ad%e8%af%81" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>重启虚拟机输入密码</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410171534-sksztsu.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410171534-sksztsu.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410171534-sksztsu.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410171534-sksztsu.png?size=large 2x" data-title="image.png" style="--width: 736px;--aspect-ratio: 736 / 470;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410171546-9gg429b.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410171546-9gg429b.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410171546-9gg429b.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220410171546-9gg429b.png?size=large 2x" data-title="image.png" style="--width: 593px;--aspect-ratio: 593 / 185;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>‍</p>
<h2 id="lab11-2" class="heading-element"><span>Lab11-2</span>
  <a href="#lab11-2" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>strings lab11-02.dll查看</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411100317-2xfsoee.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411100317-2xfsoee.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411100317-2xfsoee.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411100317-2xfsoee.png?size=large 2x" data-title="image.png" style="--width: 905px;--aspect-ratio: 905 / 749;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>strings 查看ini文件</p>
<p>文件被加密</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411104148-3o26ltb.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411104148-3o26ltb.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411104148-3o26ltb.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411104148-3o26ltb.png?size=large 2x" data-title="image.png" style="--width: 1093px;--aspect-ratio: 1093 / 168;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>dependency walker 查看</p>
<p>CreateToolhelp32Snapshot</p>
<p>用于给当前进程或线程拍摄快照</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411100426-xzv2egr.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411100426-xzv2egr.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411100426-xzv2egr.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411100426-xzv2egr.png?size=large 2x" data-title="image.png" style="--width: 1408px;--aspect-ratio: 1408 / 487;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>注册表操作</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411100539-1fjv4tl.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411100539-1fjv4tl.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411100539-1fjv4tl.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411100539-1fjv4tl.png?size=large 2x" data-title="image.png" style="--width: 1279px;--aspect-ratio: 1279 / 264;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h2 id="1这个恶意dll导出了什么" class="heading-element"><span>1.这个恶意DLL导出了什么?</span>
  <a href="#1%e8%bf%99%e4%b8%aa%e6%81%b6%e6%84%8fdll%e5%af%bc%e5%87%ba%e4%ba%86%e4%bb%80%e4%b9%88" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>installer</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411100616-bad43n6.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411100616-bad43n6.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411100616-bad43n6.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411100616-bad43n6.png?size=large 2x" data-title="image.png" style="--width: 1010px;--aspect-ratio: 1010 / 353;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h2 id="2使用rundll32exe安装这个恶意代码后发生了什么" class="heading-element"><span>2.使用rundll32.exe安装这个恶意代码后，发生了什么?</span>
  <a href="#2%e4%bd%bf%e7%94%a8rundll32exe%e5%ae%89%e8%a3%85%e8%bf%99%e4%b8%aa%e6%81%b6%e6%84%8f%e4%bb%a3%e7%a0%81%e5%90%8e%e5%8f%91%e7%94%9f%e4%ba%86%e4%bb%80%e4%b9%88" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>dll文件不能直接监控所以要监控rundll32</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411100914-saeye1y.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411100914-saeye1y.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411100914-saeye1y.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411100914-saeye1y.png?size=large 2x" data-title="image.png" style="--width: 533px;--aspect-ratio: 533 / 341;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>运行时跟上参数</p>
<p>rundll32.exe Lab11-02.dll,installer</p>
<p>创建了文件</p>
<p>spoolvxx32.dll</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411102807-c5qxu9d.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411102807-c5qxu9d.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411102807-c5qxu9d.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411102807-c5qxu9d.png?size=large 2x" data-title="image.png" style="--width: 1522px;--aspect-ratio: 1522 / 877;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>md5对比相同</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411101604-j693ttv.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411101604-j693ttv.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411101604-j693ttv.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411101604-j693ttv.png?size=large 2x" data-title="image.png" style="--width: 511px;--aspect-ratio: 511 / 370;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411102917-0bwzfp9.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411102917-0bwzfp9.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411102917-0bwzfp9.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411102917-0bwzfp9.png?size=large 2x" data-title="image.png" style="--width: 502px;--aspect-ratio: 502 / 367;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>系统目录中复制了文件</p>
<h2 id="3为了使这个恶意代码正确安装lab11-o2ini-必须放置在何处" class="heading-element"><span>3.为了使这个恶意代码正确安装，Lab11-O2.ini 必须放置在何处?</span>
  <a href="#3%e4%b8%ba%e4%ba%86%e4%bd%bf%e8%bf%99%e4%b8%aa%e6%81%b6%e6%84%8f%e4%bb%a3%e7%a0%81%e6%ad%a3%e7%a1%ae%e5%ae%89%e8%a3%85lab11-o2ini-%e5%bf%85%e9%a1%bb%e6%94%be%e7%bd%ae%e5%9c%a8%e4%bd%95%e5%a4%84" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>程序试图打开这个文件，但文件未找到</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411103046-n4icn60.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411103046-n4icn60.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411103046-n4icn60.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411103046-n4icn60.png?size=large 2x" data-title="image.png" style="--width: 1462px;--aspect-ratio: 1462 / 576;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>将Lab11-O2.ini放到c:\windows\system32下即可</p>
<p>‍</p>
<h2 id="4这个安装的恶意代码如何驻留" class="heading-element"><span>4.这个安装的恶意代码如何驻留?</span>
  <a href="#4%e8%bf%99%e4%b8%aa%e5%ae%89%e8%a3%85%e7%9a%84%e6%81%b6%e6%84%8f%e4%bb%a3%e7%a0%81%e5%a6%82%e4%bd%95%e9%a9%bb%e7%95%99" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>在注册表里添加了恶意程序</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411103455-l6g0668.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411103455-l6g0668.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411103455-l6g0668.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411103455-l6g0668.png?size=large 2x" data-title="image.png" style="--width: 1623px;--aspect-ratio: 1623 / 801;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h2 id="5这个恶意代码采用的用户态-rootkit技术是什么" class="heading-element"><span>5.这个恶意代码采用的用户态 Rootkit技术是什么?</span>
  <a href="#5%e8%bf%99%e4%b8%aa%e6%81%b6%e6%84%8f%e4%bb%a3%e7%a0%81%e9%87%87%e7%94%a8%e7%9a%84%e7%94%a8%e6%88%b7%e6%80%81-rootkit%e6%8a%80%e6%9c%af%e6%98%af%e4%bb%80%e4%b9%88" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>ida分析lab11-02.dll</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411103701-sbhcsq1.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411103701-sbhcsq1.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411103701-sbhcsq1.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411103701-sbhcsq1.png?size=large 2x" data-title="image.png" style="--width: 1052px;--aspect-ratio: 1052 / 538;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>重命名和更改注册表</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411103751-1yeirtm.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411103751-1yeirtm.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411103751-1yeirtm.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411103751-1yeirtm.png?size=large 2x" data-title="image.png" style="--width: 842px;--aspect-ratio: 842 / 547;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>分析1000105b函数</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411103848-zhqomyu.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411103848-zhqomyu.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411103848-zhqomyu.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411103848-zhqomyu.png?size=large 2x" data-title="image.png" style="--width: 547px;--aspect-ratio: 547 / 557;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>获取系统路径</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411103910-jkpeaii.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411103910-jkpeaii.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411103910-jkpeaii.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411103910-jkpeaii.png?size=large 2x" data-title="image.png" style="--width: 452px;--aspect-ratio: 452 / 319;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>将系统路径和Lab11-02.ini进行拼接尝试打开ini文件，如果可以打开则读取</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411104011-yesj594.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411104011-yesj594.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411104011-yesj594.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411104011-yesj594.png?size=large 2x" data-title="image.png" style="--width: 915px;--aspect-ratio: 915 / 650;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>将读取的文件内容作为sub_100010B3参数传入（可能是解密）</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411104211-5sqz4b1.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411104211-5sqz4b1.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411104211-5sqz4b1.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411104211-5sqz4b1.png?size=large 2x" data-title="image.png" style="--width: 633px;--aspect-ratio: 633 / 371;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>将lab11-02.dll和ini文件拖入这个路径，然后lab11-02.dll改名为spoolvxx32.dll</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411104750-jo4d1hp.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411104750-jo4d1hp.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411104750-jo4d1hp.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411104750-jo4d1hp.png?size=large 2x" data-title="image.png" style="--width: 790px;--aspect-ratio: 790 / 596;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>od打开ldd文件跳转到解密函数</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411105216-kfd0wz8.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411105216-kfd0wz8.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411105216-kfd0wz8.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411105216-kfd0wz8.png?size=large 2x" data-title="image.png" style="--width: 489px;--aspect-ratio: 489 / 150;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>下断点后运行，查看参数发现无法识别的</p>
<p>ctrl+g</p>
<p>f2</p>
<p>f9</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411105504-tldeujg.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411105504-tldeujg.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411105504-tldeujg.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411105504-tldeujg.png?size=large 2x" data-title="image.png" style="--width: 1498px;--aspect-ratio: 1498 / 830;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>查看解密结果，是个邮箱</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411105521-823wkq4.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411105521-823wkq4.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411105521-823wkq4.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411105521-823wkq4.png?size=large 2x" data-title="image.png" style="--width: 1591px;--aspect-ratio: 1591 / 673;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>将函数重命名为email address</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411105627-9n6kev0.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411105627-9n6kev0.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411105627-9n6kev0.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411105627-9n6kev0.png?size=large 2x" data-title="image.png" style="--width: 467px;--aspect-ratio: 467 / 130;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>hook安装</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411105802-6gh6srm.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411105802-6gh6srm.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411105802-6gh6srm.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411105802-6gh6srm.png?size=large 2x" data-title="image.png" style="--width: 329px;--aspect-ratio: 329 / 155;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>内联hook原理</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411105724-51gciov.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411105724-51gciov.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411105724-51gciov.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411105724-51gciov.png?size=large 2x" data-title="image.png" style="--width: 1221px;--aspect-ratio: 1221 / 840;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>函数10001075返回绝对路径</p>
<p>函数10001104提取路径内容</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411110000-bgu9t8r.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411110000-bgu9t8r.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411110000-bgu9t8r.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411110000-bgu9t8r.png?size=large 2x" data-title="image.png" style="--width: 534px;--aspect-ratio: 534 / 287;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>确定程序名是不是(THEBAT.EXE    OUTLOOK.EXE    MSIMN.EXE)中的一个,不是结束,是的话看loc_10001561</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411110233-52m3r3l.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411110233-52m3r3l.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411110233-52m3r3l.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411110233-52m3r3l.png?size=large 2x" data-title="image.png" style="--width: 566px;--aspect-ratio: 566 / 332;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>观察发现sub_100013BD和sub_10001499函数及其相似,他们都会查找当前进程的所以线程,只是对线程的处理方式不一样,一个是挂起除了当前线程外的其他线程,一个是唤醒其他线程.</p>
<p>好了,现在只剩下最难的sub_100012A4,牢记这四个参数,都很重要</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411110316-cokdarc.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411110316-cokdarc.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411110316-cokdarc.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411110316-cokdarc.png?size=large 2x" data-title="image.png" style="--width: 464px;--aspect-ratio: 464 / 214;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>进入程序,头三个函数调用很明确,加载wsock32.dll,然后得到send函数地址</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411110343-5nkrsof.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411110343-5nkrsof.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411110343-5nkrsof.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411110343-5nkrsof.png?size=large 2x" data-title="image.png" style="--width: 847px;--aspect-ratio: 847 / 635;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>接着调用sub_10001203(三个参数,其中第一个是send函数地址)</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411110403-zcd0u4x.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411110403-zcd0u4x.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411110403-zcd0u4x.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411110403-zcd0u4x.png?size=large 2x" data-title="image.png" style="--width: 540px;--aspect-ratio: 540 / 383;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>程序的头尾都调用virtualprotect,一个是修改send代码区域可读写,一个是恢复原来的保护</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220723160851-n61lpjq.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220723160851-n61lpjq.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220723160851-n61lpjq.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220723160851-n61lpjq.png?size=large 2x" data-title="image.png" style="--width: 544px;--aspect-ratio: 544 / 120;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>这段代码把原来send函数的头五个字节保存在申请的内存空间</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220723161001-mxotlln.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220723161001-mxotlln.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220723161001-mxotlln.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220723161001-mxotlln.png?size=large 2x" data-title="image.png" style="--width: 507px;--aspect-ratio: 507 / 230;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>这段代码是对原来send函数代码的修改(我对一些参数和局部变量重命名,为了更好理解)</p>
<p>首先要注意三个地址,一个是lp_send_address这是send原函数的地址,一个是p_p_sub_1000113d地址他是函数1000113d的地址(这个函数会在send之前被调用,也就是说send函数被这个函数挂钩了),还有一个malloc_space这是临时申请的内存空间地址(他会被用来存放原来send函数的头五个字节和一个跳转命令)<br>
​<img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083305-4bglazw.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083305-4bglazw.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083305-4bglazw.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083305-4bglazw.png?size=large 2x" data-title="image.png" style="--width: 352px;--aspect-ratio: 352 / 191;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>一个一个来,看第一个E9h的赋值语句,E9就是jmp,E9被赋值给malloc_space的0a偏移处,第二个eax被赋值到偏移0b处(这两个语句中edx和ecx都是malloc_space)很明显这是跟在jmp后面的一个相对地址,他的值是send的原函数地址相对于malloc_space 0a偏移处的地址大小(这条jmp语句的执行效果就是跳转到被修改后的send函数的第一个一句jmp(jmp是5字节)后的代码,想一下eip的计算就知道为啥,eip=原eip+该汇编代码字节数(jmp是5字节)+jmp后面跟的相对地址).<br>
​<img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083410-8cr7vid.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083410-8cr7vid.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083410-8cr7vid.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083410-8cr7vid.png?size=large 2x" data-title="image.png" style="--width: 349px;--aspect-ratio: 349 / 132;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>上面是对malloc_space的一系列操作,下面是对原send函数的操作,同样是修改第一个字节为E9,然后第二个字节开始是ecx这里的ecx是挂钩函数sub_1000113d的地址(很明显是把send的头五个字节改成jmp sub_1000113d)</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083410-8cr7vid.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083410-8cr7vid.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083410-8cr7vid.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083410-8cr7vid.png?size=large 2x" data-title="image.png" style="--width: 349px;--aspect-ratio: 349 / 132;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>看最后的操作,把malloc_space偏移为5(为啥偏移为5看上面memcpy)的地址赋值给sub_10003484,这样call sub_10003484,就会执行原send函数头五字节汇编代码,然后跳回send继续执行剩下的send代码.</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083454-2iplb11.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083454-2iplb11.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083454-2iplb11.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083454-2iplb11.png?size=large 2x" data-title="image.png" style="--width: 355px;--aspect-ratio: 355 / 165;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>挂钩分析完毕,现在只剩下,挂钩函数sub_1000113d了,关键在于两个memcpy</p>
<p>复制RCPT TO: &lt;到dst</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083639-yr8gi4g.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083639-yr8gi4g.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083639-yr8gi4g.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083639-yr8gi4g.png?size=large 2x" data-title="image.png" style="--width: 392px;--aspect-ratio: 392 / 100;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>头两个push是memcpy的参数,strlen的参数是第三个push,把src复制到dst这里的src是之前翻译出来的邮箱地址</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083704-vv6e7xk.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083704-vv6e7xk.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083704-vv6e7xk.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083704-vv6e7xk.png?size=large 2x" data-title="image.png" style="--width: 394px;--aspect-ratio: 394 / 133;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>最后把send的四个参数传给10003484,det就是消息,eax是长度,s是套接口描述字</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083749-mh6i503.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083749-mh6i503.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083749-mh6i503.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724083749-mh6i503.png?size=large 2x" data-title="image.png" style="--width: 404px;--aspect-ratio: 404 / 223;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>说了这么多,其实就是在我们发邮件的时候,添加一个收件人,这个收件人就是上面提到的的邮箱地址</p>
<p>分析结束(几个虚拟机都没有outlook这几个软件就没有抓包,演示了)</p>
<p>使用的技术是内联hook</p>
<h2 id="6挂钩代码做了什么" class="heading-element"><span>6.挂钩代码做了什么?</span>
  <a href="#6%e6%8c%82%e9%92%a9%e4%bb%a3%e7%a0%81%e5%81%9a%e4%ba%86%e4%bb%80%e4%b9%88" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>添加邮件发送目标，窃取邮件内容</p>
<h2 id="7哪个或者哪些进程执行这个恶意攻击为什么" class="heading-element"><span>7.哪个或者哪些进程执行这个恶意攻击，为什么?</span>
  <a href="#7%e5%93%aa%e4%b8%aa%e6%88%96%e8%80%85%e5%93%aa%e4%ba%9b%e8%bf%9b%e7%a8%8b%e6%89%a7%e8%a1%8c%e8%bf%99%e4%b8%aa%e6%81%b6%e6%84%8f%e6%94%bb%e5%87%bb%e4%b8%ba%e4%bb%80%e4%b9%88" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>THEBAT.EXE、OUTLOOK.EXE、MSIMN.EXE</p>
<h2 id="8ini文件的意义是什么" class="heading-element"><span>8.ini文件的意义是什么?</span>
  <a href="#8ini%e6%96%87%e4%bb%b6%e7%9a%84%e6%84%8f%e4%b9%89%e6%98%af%e4%bb%80%e4%b9%88" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>加密恶意邮件地址</p>
<h2 id="9你怎样用wireshark动态抓获这个恶意代码的行为" class="heading-element"><span>9.你怎样用Wireshark动态抓获这个恶意代码的行为?</span>
  <a href="#9%e4%bd%a0%e6%80%8e%e6%a0%b7%e7%94%a8wireshark%e5%8a%a8%e6%80%81%e6%8a%93%e8%8e%b7%e8%bf%99%e4%b8%aa%e6%81%b6%e6%84%8f%e4%bb%a3%e7%a0%81%e7%9a%84%e8%a1%8c%e4%b8%ba" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>恶意程序加载到内存后outlook发送邮件，wireshark监控到发送的收件人里多出一个新的收件人</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724084509-1yjsaq9.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724084509-1yjsaq9.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724084509-1yjsaq9.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724084509-1yjsaq9.png?size=large 2x" data-title="image.png" style="--width: 1128px;--aspect-ratio: 1128 / 796;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>‍</p>
<h2 id="lab11-3" class="heading-element"><span>Lab11-3</span>
  <a href="#lab11-3" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><h2 id="1使用基础的静态分析过程你可以发现什么有趣的线索" class="heading-element"><span>1.使用基础的静态分析过程，你可以发现什么有趣的线索?</span>
  <a href="#1%e4%bd%bf%e7%94%a8%e5%9f%ba%e7%a1%80%e7%9a%84%e9%9d%99%e6%80%81%e5%88%86%e6%9e%90%e8%bf%87%e7%a8%8b%e4%bd%a0%e5%8f%af%e4%bb%a5%e5%8f%91%e7%8e%b0%e4%bb%80%e4%b9%88%e6%9c%89%e8%b6%a3%e7%9a%84%e7%ba%bf%e7%b4%a2" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>strings exe程序</p>
<p>启动服务 cisvc</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411140840-plkn1yv.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411140840-plkn1yv.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411140840-plkn1yv.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411140840-plkn1yv.png?size=large 2x" data-title="image.png" style="--width: 1081px;--aspect-ratio: 1081 / 857;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>strings dll程序</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411140942-x6p5kfx.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411140942-x6p5kfx.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411140942-x6p5kfx.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411140942-x6p5kfx.png?size=large 2x" data-title="image.png" style="--width: 1266px;--aspect-ratio: 1266 / 867;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>查看dll文件，键盘记录</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411141059-ip9oomn.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411141059-ip9oomn.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411141059-ip9oomn.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411141059-ip9oomn.png?size=large 2x" data-title="image.png" style="--width: 1376px;--aspect-ratio: 1376 / 484;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h2 id="2当运行这个恶意代码时发生了什么" class="heading-element"><span>2.当运行这个恶意代码时，发生了什么?</span>
  <a href="#2%e5%bd%93%e8%bf%90%e8%a1%8c%e8%bf%99%e4%b8%aa%e6%81%b6%e6%84%8f%e4%bb%a3%e7%a0%81%e6%97%b6%e5%8f%91%e7%94%9f%e4%ba%86%e4%bb%80%e4%b9%88" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>创建了inet_epar32.dll文件</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411141400-ukzcllt.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411141400-ukzcllt.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411141400-ukzcllt.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411141400-ukzcllt.png?size=large 2x" data-title="image.png" style="--width: 1560px;--aspect-ratio: 1560 / 659;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>对比实验文件的dll和这个文件的md5</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411141517-gvcxszr.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411141517-gvcxszr.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411141517-gvcxszr.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411141517-gvcxszr.png?size=large 2x" data-title="image.png" style="--width: 510px;--aspect-ratio: 510 / 367;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411141604-dnqx5ss.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411141604-dnqx5ss.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411141604-dnqx5ss.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220411141604-dnqx5ss.png?size=large 2x" data-title="image.png" style="--width: 510px;--aspect-ratio: 510 / 366;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>一致</p>
<h2 id="3lab11-03exe-如何安装lab11-o3dll使其长期驻留" class="heading-element"><span>3.Lab11-03.exe 如何安装Lab11-O3.dll使其长期驻留?</span>
  <a href="#3lab11-03exe-%e5%a6%82%e4%bd%95%e5%ae%89%e8%a3%85lab11-o3dll%e4%bd%bf%e5%85%b6%e9%95%bf%e6%9c%9f%e9%a9%bb%e7%95%99" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>分析.exe程序,程序先复制lab11-03.dll到inet_epar32.dll,然后得到cisvc.exe的绝对路径,然后调用sub_401070函数,接着就是调用_system来启动cisvc程序,所以我们猜测关键在于sub_401070函数对原cisvc文件做了什么事,进入sub_401070,可以看到开头几个函数调用事打开cisvc,然后映射到内存,以便后面的修改操作.一直到下面的函数调用sub_401000</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724085355-ukfaxbh.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724085355-ukfaxbh.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724085355-ukfaxbh.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724085355-ukfaxbh.png?size=large 2x" data-title="image.png" style="--width: 558px;--aspect-ratio: 558 / 631;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/><br>
​</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724085539-qhqlk2g.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724085539-qhqlk2g.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724085539-qhqlk2g.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724085539-qhqlk2g.png?size=large 2x" data-title="image.png" style="--width: 259px;--aspect-ratio: 259 / 63;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>看sub_401000参数一个是节区数目3,一个是第一个节区名.text,函数其实是在查找.text节区头的头8字节是否具有内存访问权限,以便后面修改,并且返回.text节区头的地址</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528184736613-20220411141920-fwh5wr4.png" alt="20180528184736613.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528184736613-20220411141920-fwh5wr4.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528184736613-20220411141920-fwh5wr4.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528184736613-20220411141920-fwh5wr4.png?size=large 2x" data-title="20180528184736613.png" style="--width: 202px;--aspect-ratio: 202 / 43;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>接着的是一系列的内存操作很难一步步理解,最好是直接跳过不要陷入细节,看关键的赋值</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528192017708-20220411141932-kn5rbuf.png" alt="20180528192017708.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528192017708-20220411141932-kn5rbuf.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528192017708-20220411141932-kn5rbuf.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528192017708-20220411141932-kn5rbuf.png?size=large 2x" data-title="20180528192017708.png" style="--width: 307px;--aspect-ratio: 307 / 81;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528192342350-20220411141936-0fwyxiy.png" alt="20180528192342350.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528192342350-20220411141936-0fwyxiy.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528192342350-20220411141936-0fwyxiy.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528192342350-20220411141936-0fwyxiy.png?size=large 2x" data-title="20180528192342350.png" style="--width: 608px;--aspect-ratio: 608 / 358;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>直接动态看结果,是在如下图地方的末尾添加了一串的东西</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528192310788-20220411141944-0m3galy.png" alt="20180528192310788.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528192310788-20220411141944-0m3galy.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528192310788-20220411141944-0m3galy.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528192310788-20220411141944-0m3galy.png?size=large 2x" data-title="20180528192310788.png" style="--width: 1565px;--aspect-ratio: 1565 / 624;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>接着看,这句话是在修改程序的入口地址为1A28</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528192658512-20220411142010-ty34bia.png" alt="20180528192658512.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528192658512-20220411142010-ty34bia.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528192658512-20220411142010-ty34bia.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528192658512-20220411142010-ty34bia.png?size=large 2x" data-title="20180528192658512.png" style="--width: 273px;--aspect-ratio: 273 / 113;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528192723645-20220411142012-at2akhe.png" alt="20180528192723645.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528192723645-20220411142012-at2akhe.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528192723645-20220411142012-at2akhe.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528192723645-20220411142012-at2akhe.png?size=large 2x" data-title="20180528192723645.png" style="--width: 207px;--aspect-ratio: 207 / 43;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>用PEview打开被修改后的cisvc也可以证实,程序入口点正是被修改到,上面添加的那一段代码处</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528193406877-20220411142021-fbr5xbi.png" alt="20180528193406877.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528193406877-20220411142021-fbr5xbi.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528193406877-20220411142021-fbr5xbi.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528193406877-20220411142021-fbr5xbi.png?size=large 2x" data-title="20180528193406877.png" style="--width: 630px;--aspect-ratio: 630 / 382;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>现在只需要看一下这段代码是什么,就知道.exe文件到底干了什么坏事,用ollydbg跟随cisvc程序,到下图地方可以发现程序动态加载了inet_epar32.dll也就是lab11-03.dll文件,这就是lab11-03.dll的长期驻留方式</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528194451737-20220411142043-v0qxsaw.png" alt="20180528194451737.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528194451737-20220411142043-v0qxsaw.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528194451737-20220411142043-v0qxsaw.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528194451737-20220411142043-v0qxsaw.png?size=large 2x" data-title="20180528194451737.png" style="--width: 751px;--aspect-ratio: 751 / 200;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>现在我们开始分析lab11-03.dll,关键看一下导出函数和dllmain</p>
<p>可以看到dllmain没做什么内容,再看导出函数创建了一个线程就结束了,看来这个线程函数很关键,查看startaddress</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528195332184-20220411142058-vxtes2q.png" alt="20180528195332184.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528195332184-20220411142058-vxtes2q.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528195332184-20220411142058-vxtes2q.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528195332184-20220411142058-vxtes2q.png?size=large 2x" data-title="20180528195332184.png" style="--width: 359px;--aspect-ratio: 359 / 126;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>可以看到创建了互斥量MZ,然后打开互斥量来确定只有一个恶意线程在运行,然后创建C:\WINDOWS\System32\kernel64x.dll文件,接着SetFilePointer明显是要对上面的文件进行读写操作了,接着是函数调用</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528195945883-20220411142108-r56cxb0.png" alt="20180528195945883.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528195945883-20220411142108-r56cxb0.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528195945883-20220411142108-r56cxb0.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528195945883-20220411142108-r56cxb0.png?size=large 2x" data-title="20180528195945883.png" style="--width: 216px;--aspect-ratio: 216 / 51;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>跟进就看到一个函数调用,跟进发现这个程序很大,大致浏览一下,看个几个关键字符串和关键函数有很多的getasynckeystate调用还有getforegroundwindow函数可以推测很可能是击键记录.并且传递的参数是之前传递的参数四个buffer可能用来装,击键的记录数据</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528200513297-20220411142119-9whakbq.png" alt="20180528200513297.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528200513297-20220411142119-9whakbq.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528200513297-20220411142119-9whakbq.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528200513297-20220411142119-9whakbq.png?size=large 2x" data-title="20180528200513297.png" style="--width: 451px;--aspect-ratio: 451 / 160;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>再看后面两个函数调用,一个_sprintf是对buffer的写,一个是把,buffer写到文件kernel64x.dll,注意write参数有个ecx+80ch正好指向了var_4,而var_4之前被赋值为文件kernel64x.dll指针,所以是把buffer写到kernel64x.dll<br>
​<img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528200825784-20220411142138-ohbyb6a.png" alt="20180528200825784.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528200825784-20220411142138-ohbyb6a.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528200825784-20220411142138-ohbyb6a.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528200825784-20220411142138-ohbyb6a.png?size=large 2x" data-title="20180528200825784.png" style="--width: 412px;--aspect-ratio: 412 / 355;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>现在我们运行一下程序,然后测试一下,可以看到已经记录了很多的信息,但是记录的数据还是16进制的不太好理解记得0x54我打的应该是t键</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528203632124-20220411142150-kepxu27.png" alt="20180528203632124.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528203632124-20220411142150-kepxu27.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528203632124-20220411142150-kepxu27.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528203632124-20220411142150-kepxu27.png?size=large 2x" data-title="20180528203632124.png" style="--width: 1033px;--aspect-ratio: 1033 / 333;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>‍</p>
<h2 id="4这个恶意代码感染-windows系统的哪个文件" class="heading-element"><span>4.这个恶意代码感染 Windows系统的哪个文件?</span>
  <a href="#4%e8%bf%99%e4%b8%aa%e6%81%b6%e6%84%8f%e4%bb%a3%e7%a0%81%e6%84%9f%e6%9f%93-windows%e7%b3%bb%e7%bb%9f%e7%9a%84%e5%93%aa%e4%b8%aa%e6%96%87%e4%bb%b6" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>cisvc.exe</p>
<p>‍</p>
<p>感染前后对比</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724092005-u4my1u1.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724092005-u4my1u1.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724092005-u4my1u1.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724092005-u4my1u1.png?size=large 2x" data-title="image.png" style="--width: 1671px;--aspect-ratio: 1671 / 877;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>‍</p>
<p>将程序里所隐藏的shellcode复制到cisvc.exe里</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724092035-utodgz7.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724092035-utodgz7.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724092035-utodgz7.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724092035-utodgz7.png?size=large 2x" data-title="image.png" style="--width: 1682px;--aspect-ratio: 1682 / 884;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>‍</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724092409-8og9kda.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724092409-8og9kda.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724092409-8og9kda.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724092409-8og9kda.png?size=large 2x" data-title="image.png" style="--width: 855px;--aspect-ratio: 855 / 665;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>关于修改的前两个字节</p>
<p>感染前程序入口点</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724092644-aexx3pj.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724092644-aexx3pj.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724092644-aexx3pj.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724092644-aexx3pj.png?size=large 2x" data-title="image.png" style="--width: 427px;--aspect-ratio: 427 / 235;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>感染后程序入口点，运行程序时会先执行shellcode</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724092707-vt5gf9v.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724092707-vt5gf9v.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724092707-vt5gf9v.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724092707-vt5gf9v.png?size=large 2x" data-title="image.png" style="--width: 426px;--aspect-ratio: 426 / 231;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>od调试</p>
<p>程序入口点</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724093205-k9izfca.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724093205-k9izfca.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724093205-k9izfca.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724093205-k9izfca.png?size=large 2x" data-title="image.png" style="--width: 1922px;--aspect-ratio: 1922 / 863;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>断点在01001b0a</p>
<p>kernel32.loadLibraryExA用于将dll文件加载到内存</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724093252-xfzcnsf.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724093252-xfzcnsf.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724093252-xfzcnsf.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724093252-xfzcnsf.png?size=large 2x" data-title="image.png" style="--width: 1920px;--aspect-ratio: 1920 / 919;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724094127-dn0alvx.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724094127-dn0alvx.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724094127-dn0alvx.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724094127-dn0alvx.png?size=large 2x" data-title="image.png" style="--width: 1564px;--aspect-ratio: 1564 / 508;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>01001b1b用于获取导出函数地址</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724094258-mzbdtxo.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724094258-mzbdtxo.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724094258-mzbdtxo.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724094258-mzbdtxo.png?size=large 2x" data-title="image.png" style="--width: 1918px;--aspect-ratio: 1918 / 910;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>最后执行到程序正确的入口地址</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724094412-354hugf.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724094412-354hugf.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724094412-354hugf.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724094412-354hugf.png?size=large 2x" data-title="image.png" style="--width: 1919px;--aspect-ratio: 1919 / 894;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h2 id="5lab11-03dll做了什么" class="heading-element"><span>5.Lab11-03.dll做了什么?</span>
  <a href="#5lab11-03dll%e5%81%9a%e4%ba%86%e4%bb%80%e4%b9%88" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>主要分析导出函数zzz69806582</p>
<p>创建了一个线程</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724094807-kjl8bnh.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724094807-kjl8bnh.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724094807-kjl8bnh.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724094807-kjl8bnh.png?size=large 2x" data-title="image.png" style="--width: 829px;--aspect-ratio: 829 / 365;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>主要看StartAddress</p>
<p>创建互斥量避免线程冲突</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724094832-ozro35m.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724094832-ozro35m.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724094832-ozro35m.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724094832-ozro35m.png?size=large 2x" data-title="image.png" style="--width: 828px;--aspect-ratio: 828 / 590;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>获取文件创建句柄</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724094950-59bdgxj.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724094950-59bdgxj.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724094950-59bdgxj.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724094950-59bdgxj.png?size=large 2x" data-title="image.png" style="--width: 562px;--aspect-ratio: 562 / 228;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>函数SetFilePointer</p>
<p>dwMoveMethod的值为2表示指向文件末尾</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724095020-37gp5rl.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724095020-37gp5rl.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724095020-37gp5rl.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724095020-37gp5rl.png?size=large 2x" data-title="image.png" style="--width: 386px;--aspect-ratio: 386 / 347;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>循环调用</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724095506-j6f16j2.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724095506-j6f16j2.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724095506-j6f16j2.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724095506-j6f16j2.png?size=large 2x" data-title="image.png" style="--width: 868px;--aspect-ratio: 868 / 355;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>进入10001000</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724095534-eyc5jo7.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724095534-eyc5jo7.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724095534-eyc5jo7.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724095534-eyc5jo7.png?size=large 2x" data-title="image.png" style="--width: 1080px;--aspect-ratio: 1080 / 708;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>GetForegroundWindow 识别当前聚焦的前端窗口，告诉键盘记录器当前哪一个窗口正在执行输入</p>
<p>GetWindowTextA 获取窗口标题</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724095600-cyqhhwm.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724095600-cyqhhwm.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724095600-cyqhhwm.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724095600-cyqhhwm.png?size=large 2x" data-title="image.png" style="--width: 629px;--aspect-ratio: 629 / 213;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>在sub_10001030里</p>
<p>GetAsyncKeyState 用来识别当前按键是被按下还是弹起</p>
<p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724095901-j53qtnz.png" alt="image.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724095901-j53qtnz.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724095901-j53qtnz.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/image-20220724095901-j53qtnz.png?size=large 2x" data-title="image.png" style="--width: 332px;--aspect-ratio: 332 / 161;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>‍</p>
<p>键盘记录</p>
<h2 id="6这个恶意代码将收集的数据存放在何处" class="heading-element"><span>6.这个恶意代码将收集的数据存放在何处?</span>
  <a href="#6%e8%bf%99%e4%b8%aa%e6%81%b6%e6%84%8f%e4%bb%a3%e7%a0%81%e5%b0%86%e6%94%b6%e9%9b%86%e7%9a%84%e6%95%b0%e6%8d%ae%e5%ad%98%e6%94%be%e5%9c%a8%e4%bd%95%e5%a4%84" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p><img loading="lazy" src="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528203632124-20220411142150-kepxu27.png" alt="20180528203632124.png" srcset="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528203632124-20220411142150-kepxu27.png?size=small, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528203632124-20220411142150-kepxu27.png?size=medium 1.5x, /posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/images/20180528203632124-20220411142150-kepxu27.png?size=large 2x" data-title="20180528203632124.png" style="--width: 1033px;--aspect-ratio: 1033 / 333;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>‍</p>
<p>‍</p>
<p>参考</p>
<p><a href="https://blog.csdn.net/abel_big_xu/article/details/117633708?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522165855916616782246461892%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=165855916616782246461892&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2"target="_blank" rel="external nofollow noopener noreferrer">https://blog.csdn.net/abel_big_xu/article/details/117633708?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522165855916616782246461892%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=165855916616782246461892&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2</a><!-- raw HTML omitted -->blog<!-- raw HTML omitted -->first_rank_ecpm_v1~rank_v31_ecpm-1-117633708-null-null.185<!-- raw HTML omitted -->v2<!-- raw HTML omitted -->control&amp;utm_term=%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81&amp;spm=1018.2226.3001.4450</p>
<p>‍</p></div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="Updated on 2022-04-01 21:47:44">Updated on 2022-04-01&nbsp;</span>
      </div></div><div class="post-info-line">
        <div class="post-info-md"></div>
        <div class="post-info-share">
          <span><a href="javascript:void(0);" title="Share on X" data-sharer="twitter" data-url="http://localhost:1313/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/" data-title="恶意代码分析实战Lab11" data-hashtags="病毒分析,Binary"><i class="fa-brands fa-x-twitter fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://localhost:1313/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/" data-hashtag="病毒分析"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="http://localhost:1313/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab11/" data-title="恶意代码分析实战Lab11"><i class="fa-brands fa-weibo fa-fw" aria-hidden="true"></i></a>
  </span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href="/tags/%E7%97%85%E6%AF%92%E5%88%86%E6%9E%90/" class="post-tag" title="Tags - 病毒分析">病毒分析</a><a href="/tags/binary/" class="post-tag" title="Tags - Binary">Binary</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
    </section>
  </div><div class="post-nav"><a href="/posts/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90lab3/" class="post-nav-item" rel="prev" title="恶意代码分析实战Lab3"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>恶意代码分析实战Lab3</a><a href="/posts/2022%E5%BC%BA%E7%BD%91%E6%9D%AF-devnull/" class="post-nav-item" rel="next" title="2022 强网杯-Devnull">2022 强网杯-Devnull<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article>

  <aside class="toc" id="toc-auto" aria-label="Contents"><h2 class="toc-title">Contents&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside></main><footer class="footer">
    <div class="footer-container"><div class="footer-line powered">Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreferrer" title="Hugo 0.141.0">Hugo</a> | Theme - <a href="https://github.com/hugo-fixit/FixIt" target="_blank" rel="external" title="FixIt v0.3.16">FixIt</a>
        </div><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2025</span><span class="author" itemprop="copyrightHolder">
              <a href="/">xiaole</a></span></div><div class="footer-line visitor">
          <span id="busuanzi_container_site_uv" title='Total visitors'><i class="fa-regular fa-user fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span><span id="busuanzi_container_site_pv" class="footer-divider" title='Total visits'><i class="fa-regular fa-eye fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span>
        </div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="Back to Top"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">This website works best with JavaScript enabled.</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script>window.config={"code":{"copyTitle":"Copy to clipboard","editLockTitle":"Lock editable code block","editUnLockTitle":"Unlock editable code block","editable":true,"maxShownLines":1000},"comment":{"enable":false},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"version":"v0.3.16"};console.log('Page config:', window.config);</script><script src="/js/theme.min.js" defer></script></body>
</html>
